<span class="slc">#-- The Computer Language Shootout</span>
<span class="slc">#-- http://shootout.alioth.debian.org/</span>
<span class="slc">#-- contributed by Tobias Polzin, translated from Mike Pall's Lua program</span>
<span class="slc">#-- modified by Josh Goldfoot to use ifs for the complement routine</span>

<span class="kwc">import</span> sys

N <span class="sym">=</span> <span class="kwa">int</span><span class="sym">(</span>sys<span class="sym">.</span>argv<span class="sym">[</span><span class="num">1</span><span class="sym">])</span>
first <span class="sym">=</span> None
second <span class="sym">=</span> None
meetings <span class="sym">=</span> <span class="num">0</span>

RED<span class="sym">,</span> BLUE<span class="sym">,</span> YELLOW <span class="sym">=</span> <span class="kwa">xrange</span><span class="sym">(</span><span class="num">1</span><span class="sym">,</span><span class="num">4</span><span class="sym">)</span>

<span class="slc">#-- Create a very social creature.</span>
<span class="kwb">def</span> <span class="kwd">creature</span><span class="sym">(</span>me<span class="sym">):</span>
    <span class="kwa">global</span> N<span class="sym">,</span> first<span class="sym">,</span> second<span class="sym">,</span> meetings
    met <span class="sym">=</span> <span class="num">0</span>
    <span class="kwb">while</span> <span class="num">1</span><span class="sym">:</span>
        <span class="slc">#-- Meet another creature.</span>

        <span class="slc">#-- Wait until meeting place clears.</span>
        <span class="kwb">while</span> second<span class="sym">:</span>
            yield None

        other <span class="sym">=</span> first
        <span class="kwb">if</span> other<span class="sym">:</span>
            <span class="slc">#-- Hey, I found a new friend!</span>
            second <span class="sym">=</span> me
        <span class="kwb">else</span><span class="sym">:</span>
            <span class="slc"># -- Sniff, nobody here (yet).</span>
            <span class="kwb">if</span> N <span class="sym">&lt;=</span> <span class="num">0</span><span class="sym">:</span>
                <span class="slc">#-- Uh oh, the mall is closed.</span>
                meetings <span class="sym">+=</span> met
                yield None

                <span class="slc"># The mall was closed, so everyone is faded.</span>
                <span class="kwb">raise</span> StopIteration
            N <span class="sym">-=</span> <span class="num">1</span>
            first <span class="sym">=</span> me
            <span class="kwb">while not</span> second<span class="sym">:</span>
                yield None <span class="slc">#-- Wait for another creature.</span>
            other <span class="sym">=</span> second

            first <span class="sym">=</span> None
            second <span class="sym">=</span> None
            yield None

        <span class="slc"># perform meeting</span>
        met <span class="sym">+=</span> <span class="num">1</span>
        <span class="kwb">if</span> me <span class="sym">!=</span> other<span class="sym">:</span>
            <span class="kwb">if</span> me <span class="sym">==</span> BLUE<span class="sym">:</span>
                me <span class="sym">=</span> other <span class="sym">==</span> RED <span class="kwb">and</span> YELLOW <span class="kwb">or</span> RED
            <span class="kwb">elif</span> me <span class="sym">==</span> RED<span class="sym">:</span>
                me <span class="sym">=</span> other <span class="sym">==</span> BLUE <span class="kwb">and</span> YELLOW <span class="kwb">or</span> BLUE
            <span class="kwb">elif</span> me <span class="sym">==</span> YELLOW<span class="sym">:</span>
                me <span class="sym">=</span> other <span class="sym">==</span> BLUE <span class="kwb">and</span> RED <span class="kwb">or</span> BLUE

<span class="slc">#-- Trivial round-robin scheduler.</span>
<span class="kwb">def</span> <span class="kwd">schedule</span><span class="sym">(</span>threads<span class="sym">):</span>
    <span class="kwa">global</span> meetings
    <span class="kwb">try</span><span class="sym">:</span>
        <span class="kwb">while</span> <span class="num">1</span><span class="sym">:</span>
            <span class="kwb">for</span> thread <span class="kwb">in</span> threads<span class="sym">:</span>
                thread<span class="sym">.</span><span class="kwd">next</span><span class="sym">()</span>
    <span class="kwb">except</span> StopIteration<span class="sym">:</span>
        <span class="kwb">return</span> meetings

<span class="kwb">def</span> <span class="kwd">main</span><span class="sym">():</span>
    <span class="slc">#-- A bunch of colorful creatures.</span>
    threads <span class="sym">= [</span>
        <span class="kwd">creature</span><span class="sym">(</span>BLUE<span class="sym">),</span>
        <span class="kwd">creature</span><span class="sym">(</span>RED<span class="sym">),</span>
        <span class="kwd">creature</span><span class="sym">(</span>YELLOW<span class="sym">),</span>
        <span class="kwd">creature</span><span class="sym">(</span>BLUE<span class="sym">) ]</span>

    <span class="kwb">print</span> <span class="kwd">schedule</span><span class="sym">(</span>threads<span class="sym">)</span>

<span class="kwd">main</span><span class="sym">()</span>
