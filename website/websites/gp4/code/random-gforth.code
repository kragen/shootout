<span class="slc">\ -*- mode: forth -*-</span>
<span class="slc">\ $Id: random-gforth.code,v 1.18 2007-04-17 17:42:46 igouy-guest Exp $</span>
<span class="slc">\ http://www.bagley.org/~doug/shootout/</span>
<span class="slc">\ from Jorge Acereda Maciá</span>

<span class="num">0</span><span class="sym">.</span> argc <span class="sym">&#64;</span> <span class="num">1</span><span class="sym">-</span> arg <span class="sym">&gt;</span>number <span class="num">2</span><span class="kwa">drop drop constant</span> NUM

<span class="sym">:</span> FIM <span class="num">1</span>e <span class="num">139968</span>e f<span class="sym">/</span> <span class="kwa">POSTPONE</span> FLITERAL <span class="sym">;</span> <span class="kwa">immediate</span>
<span class="sym">:</span> IA <span class="num">3877</span> <span class="kwa">POSTPONE LITERAL</span> <span class="sym">;</span> <span class="kwa">immediate</span>
<span class="sym">:</span> IC <span class="num">29573</span> <span class="kwa">POSTPONE LITERAL</span> <span class="sym">;</span> <span class="kwa">immediate</span>
<span class="sym">:</span> IM <span class="num">139968</span> <span class="kwa">POSTPONE LITERAL</span> <span class="sym">;</span> <span class="kwa">immediate</span>
<span class="num">42</span> value seed

<span class="slc">\ n = the uth power of n1</span>
<span class="sym">:</span> pow <span class="com">( n1 u -- n )</span>
  <span class="num">1</span> <span class="kwa">swap</span> <span class="num">0</span> u<span class="sym">+</span><span class="kwa">do over</span> <span class="sym">*</span> <span class="kwa">loop</span> nip <span class="sym">;</span>

<span class="slc">\ print float r with n fixed decimal points</span>
<span class="sym">:</span> ffix <span class="com">( r n -- )</span>
  <span class="kwa">dup</span> <span class="num">10</span> <span class="kwa">swap</span> pow <span class="num">0</span> d<span class="sym">&gt;</span>f f<span class="sym">*</span> <span class="num">0.5</span>e0 f<span class="sym">+</span> f<span class="sym">&gt;</span>d
  <span class="sym">&lt;&lt;#</span> <span class="kwa">rot</span> <span class="num">0</span> <span class="sym">?</span><span class="kwa">do</span> <span class="sym">#</span> <span class="kwa">loop</span> <span class="sym">[</span><span class="kwa">char</span><span class="sym">] .</span> <span class="kwa">hold</span> <span class="sym">#</span>s <span class="sym">#&gt;</span> type <span class="sym">#&gt;&gt; ;</span>

<span class="sym">:</span> gen<span class="sym">-</span>random
    s<span class="str">&quot; seed IA * IC + IM mod dup to seed &quot;</span> <span class="kwa">evaluate</span>
    s<span class="str">&quot; 0 d&gt;f f* FIM f* &quot;</span> <span class="kwa">evaluate</span> <span class="sym">;</span> <span class="kwa">immediate</span>

<span class="sym">:</span> main
    <span class="num">10</span> SET<span class="sym">-</span>PRECISION
    <span class="num">0</span>e NUM <span class="num">0</span> <span class="kwa">do</span> fdrop <span class="num">100</span>e gen<span class="sym">-</span>random <span class="kwa">loop</span> <span class="num">9</span> ffix <span class="kwa">cr</span> <span class="sym">;</span>

main bye
